{"version":3,"file":"bundle.js","sources":["/Users/mauricio/Documents/web/maurizzzio.me/pojoviz/node_modules/browserify/node_modules/browser-pack/_prelude.js","/Users/mauricio/Documents/web/maurizzzio.me/pojoviz/src/renderer/index.js","/Users/mauricio/Documents/web/maurizzzio.me/pojoviz/src/renderer/d3/index.js","/Users/mauricio/Documents/web/maurizzzio.me/pojoviz/src/renderer/three/index.js","/Users/mauricio/Documents/web/maurizzzio.me/pojoviz/src/renderer/three/PanControls.js","/Users/mauricio/Documents/web/maurizzzio.me/pojoviz/src/renderer/d3/Canvas.js","/Users/mauricio/Documents/web/maurizzzio.me/pojoviz/src/util/index.js","/Users/mauricio/Documents/web/maurizzzio.me/pojoviz/src/renderer/d3/Node.js","/Users/mauricio/Documents/web/maurizzzio.me/pojoviz/src/util/hashKey.js","/Users/mauricio/Documents/web/maurizzzio.me/pojoviz/src/renderer/d3/Property.js"],"names":["module","exports","d3","require","three","global","pojoviz","addRenderers","Canvas","canvas","clean","destroy","render","data","t3","window","_","THREE","id","instance","el","document","getElementById","firstChild","removeChild","style","display","loopManager","stop","getY","node","i","y","height","properties","length","getX","x","width","margin","left","createCameraControls","camera","domElement","cameraControls","PanControls","drawProperties","group","createElement","context","getContext","font","fillStyle","fillText","label","match","replace","top","forEach","property","type","defaultColor","name","titleHeight","texture","Texture","needsUpdate","material","MeshBasicMaterial","map","side","DoubleSide","transparent","mesh","Mesh","PlaneGeometry","position","set","add","drawNodes","me","this","nodeGroup","Object3D","Geometry","nodes","points","push","Vector2","shape","Shape","createPointsGeometry","geometry","ShapeGeometry","LineBasicMaterial","color","lineWidth","userData","activeScene","nodeMeshes","drawCircles","circleMesh","CircleGeometry","meshes","object","borderStyle","function","updateMatrix","merge","matrix","generateSpline","f","mid","t","index","mult","bumpZ","z","fm","Vector3","addVectors","multiplyScalar","mt","spline","Spline","l","colors","getPoint","vertices","Color","setHSL","drawEdges","fromV","toV","edges","link","from","nodeMap","to","findIndex","d","distanceTo","setZ","opacity","linewidth","vertexColors","VertexColors","Line","number","string","boolean","undefined","projector","Projector","wrapperEl","themes","allWhite","clearColor","fogColor","groundColor","wrapper","bbox","getBoundingClientRect","run","theme","ambientConfig","ground","axes","gridY","gridX","gridZ","init","rendererEl","renderer","datgui","close","fog","sortObjects","shadowMapEnabled","shadowMapType","PCFShadowMap","mouse","moved","down","addEventListener","cursor","e","preventDefault","cx","clientX","cy","clientY","clientWidth","clientHeight","vector","unprojectVector","activeCamera","raycaster","Raycaster","sub","normalize","intersects","intersectObjects","iObject","dest","TWEEN","Tween","easing","Easing","Cubic","InOut","start","target","fov","ratio","near","far","PerspectiveCamera","center","Math","min","mx","mn","addCamera","setActiveCamera","noKeys","call","update","delta","ac","getAutoRotationAngle","PI","scope","autoRotateSpeed","getZoomScale","pow","zoomSpeed","onMouseDown","event","enabled","button","noRotate","state","STATE","ROTATE","rotateStart","noZoom","DOLLY","dollyStart","noPan","PAN","panStart","onMouseMove","onMouseUp","dispatchEvent","startEvent","element","body","rotateEnd","rotateDelta","subVectors","rotateLeft","rotateSpeed","rotateUp","copy","dollyEnd","dollyDelta","dollyIn","dollyOut","panEnd","panDelta","pan","removeEventListener","endEvent","NONE","onMouseWheel","stopPropagation","wheelDelta","detail","onKeyDown","keyCode","keys","UP","keyPanSpeed","BOTTOM","LEFT","RIGHT","touchstart","touches","TOUCH_ROTATE","pageX","pageY","TOUCH_DOLLY","dx","dy","distance","sqrt","TOUCH_PAN","touchmove","touchend","minDistance","maxDistance","Infinity","autoRotate","minPolarAngle","maxPolarAngle","EPS","panOffset","offset","phiDelta","thetaDelta","scale","lastPosition","lastQuaternion","Quaternion","target0","clone","position0","quat","setFromUnitVectors","up","quatInverse","inverse","changeEvent","angle","panLeft","te","elements","panUp","deltaX","deltaY","targetDistance","tan","right","bottom","console","warn","dollyScale","applyQuaternion","theta","atan2","phi","max","radius","sin","cos","lookAt","distanceToSquared","dot","quaternion","reset","prototype","Object","create","EventDispatcher","uniqueId","createRoot","utils","pojoVizNode","svg","select","prefix","prefixer","escapeCls","transformProperty","attr","selectAll","remove","root","append","obj","fixZoom","redraw","translation","translate","newX","newY","transform","zoomBehavior","classed","scr","getBBox","screenWidth","screenHeight","canvasWidth","canvasHeight","sx","sy","isFinite","zoom","behavior","on","transition","duration","renderNodes","renderEdges","mouseEvent","over","diagonal","source","fromData","datum","propertyData","toData","projection","enter","join","opacityToggle","decrease","nodeCtor","propertiesTransformation","[[Prototype]]","assert","v","message","s","forOwn","k","apply","args","slice","arguments","unshift","hasOwnProperty","toQueryString","createEvent","eventName","details","CustomEvent","notification","consoleToo","ev","log","createJsonpCallback","url","script","src","head","appendChild","Node","parent","my","selection","groupMouseBehavior","labelEscaped","predecessors","successors","nodeEnter","text","bodyEnter","propertyCtor","pojoVizProperty","p","each","rect","m","hashKey","isObjectOrFunction","get","hiddenKey","key","defineProperty","value","uid","createHashKeysFor","err","localToString","toString","hasAClassName","getName","className","constructor","has","Property","propertyY","propertyEnter","insert","parentNode"],"mappings":"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","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error(\"Cannot find module '\"+o+\"'\")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","module.exports = {\n  d3: require('./d3/'),\n  three: require('./three/')\n};\n\n// it's not a standalone package\n// but it extends pojoviz's functionality\nglobal.pojoviz.addRenderers(module.exports);","var Canvas = require('./Canvas'),\n  canvas;\n\nmodule.exports = {\n  clean: function () {\n    if (canvas) {\n      canvas.destroy();\n    }\n  },\n  render: function (data) {\n    canvas = new Canvas(data);\n    canvas.render();\n  }\n};","require('./PanControls');\n\nvar t3 = (typeof window !== \"undefined\" ? window.t3 : typeof global !== \"undefined\" ? global.t3 : null),\n  _ = require('lodash'),\n  THREE = (typeof window !== \"undefined\" ? window.THREE : typeof global !== \"undefined\" ? global.THREE : null),\n  id = 'threejscanvas',\n  instance;\n\nmodule.exports = {\n  clean: function () {\n    var el = document.getElementById(id);\n    while(el.firstChild) {\n      el.removeChild(el.firstChild);\n    }\n    el.style.display = 'none';\n    if (instance) {\n      instance.loopManager.stop();\n    }\n  },\n  render: function (data) {\n    var nodes = data.nodes,\n      edges = data.edges,\n      nodeMap = {},\n      margin = {\n        top: 10,\n        left: 10\n      },\n      fillStyle = {\n        number: '#673ab7',\n        'string': '#ff9800',\n        'boolean': '#259b24',\n        'undefined': '#000000'\n      },\n      borderStyle = {\n        object: '#03a9f4',\n        'function': '#e51c23'\n      },\n      defaultColor = '#000000',\n      titleHeight = 40,\n      projector = new THREE.Projector(),\n      nodeMeshes = [];\n\n    nodes.forEach(function (node) {\n      nodeMap[node.label] = node;\n    });\n\n    var wrapperEl = document.getElementById(id);\n    wrapperEl.style.display = 'block';\n\n    // pre init\n    t3.themes.allWhite = {\n      clearColor: 0xffffff,\n      fogColor: 0xffffff,\n      groundColor: 0xffffff\n    };\n    var wrapper = document.getElementById(id),\n      bbox = wrapper.getBoundingClientRect();\n\n    function getY(node, i) {\n      return node.y - node.height * 0.5 +\n        (node.properties.length - i) * 15;\n    }\n\n    function getX(node) {\n      return node.x - node.width * 0.5 + margin.left;\n    }\n\n    function createCameraControls(camera, domElement) {\n      camera.cameraControls = new THREE.PanControls(camera, domElement);\n    }\n\n    function createTextSprites() {\n      var shapes = THREE.FontUtils.generateShapes(\"Hello world\", {\n        font: \"helvetiker\",\n        weight: \"bold\",\n        size: 10\n      });\n      var geom = new THREE.ShapeGeometry(shapes);\n      var mat = new THREE.MeshBasicMaterial();\n      return new THREE.Mesh(geom, mat);\n    }\n\n    function drawProperties(node, group) {\n      var canvas = document.createElement('canvas');\n      canvas.width = node.width;\n      canvas.height = node.height;\n      var context = canvas.getContext('2d');\n      context.font = \"normal 100 18px Roboto\";\n      context.fillStyle = \"rgba(0, 0, 0, 1)\";\n      context.fillText(\n        node.label\n          .match(/^\\S*?-([\\S-]*)$/)[1]\n          .replace(/-/, '.'),\n        margin.left,\n        margin.top + 15\n      );\n\n      node.properties.forEach(function (property, i) {\n        var sphere;\n\n        // draw text on the canvas\n        context.font = \"normal 15px Arial\";\n        context.fillStyle = fillStyle[property.type] || defaultColor;\n        context.fillText(\n          property.name,\n          margin.left * 2,\n          margin.top + titleHeight + i * 15\n        );\n      });\n\n      var texture = new THREE.Texture(canvas);\n      texture.needsUpdate = true;\n\n      var material = new THREE.MeshBasicMaterial({\n        map: texture,\n        side:THREE.DoubleSide\n      });\n      material.transparent = true;\n      var mesh = new THREE.Mesh(\n          new THREE.PlaneGeometry(canvas.width, canvas.height),\n          material\n      );\n      // mesh.position.x += node.width / 2;\n      // mesh.position.y += node.height / 2;\n\n      mesh.position.set(\n        node.x,\n        node.y,\n        0.1\n      );\n\n      group.add(mesh);\n    }\n\n    function drawNodes() {\n      var me = this,\n        nodeGroup = new THREE.Object3D(),\n        nodeGeometry = new THREE.Geometry();\n\n      nodes.forEach(function (node) {\n        var points = [],\n         g = new THREE.Object3D();\n        points.push(new THREE.Vector2(0, 0));\n        points.push(new THREE.Vector2(node.width, 0));\n        points.push(new THREE.Vector2(node.width, node.height));\n        points.push(new THREE.Vector2(0, node.height));\n\n        var shape = new THREE.Shape(points);\n        points = shape.createPointsGeometry();\n\n        var type = node.label\n          .match(/^(\\S*?)-/)[1];\n        var geometry = new THREE.ShapeGeometry(shape);\n        var mesh = new THREE.Mesh(\n          geometry,\n          new THREE.LineBasicMaterial({\n            color: '#eeeeee',// borderStyle['function'],\n            lineWidth: 1\n          })\n        );\n\n        mesh.userData.node = node;\n        mesh.position.set(\n          node.x - node.width * 0.5,\n          node.y - node.height * 0.5,\n          0\n        );\n\n        // EACH ONE IS A SINGLE MESH\n        me.activeScene.add(mesh);\n        nodeMeshes.push(mesh);\n\n        // MERGE\n        // mesh.updateMatrix();\n        // nodeGeometry.merge(mesh.geometry, mesh.matrix);\n\n        // add the description in another group\n        drawProperties(node, nodeGroup);\n      });\n\n      me.activeScene.add(nodeGroup);\n\n      // MERGE\n      // me.activeScene.add(new THREE.Mesh(\n      //   nodeGeometry,\n      //   new THREE.LineBasicMaterial({\n      //     color: '#eeeeee',// borderStyle['function'],\n      //     lineWidth: 1\n      //   })\n      // ));\n    }\n\n    function drawCircles() {\n      var me = this,\n        circleMesh = new THREE.Mesh(new THREE.CircleGeometry(5, 8)),\n        meshes = {\n          object: {\n            material: new THREE.MeshBasicMaterial({\n              color: borderStyle.object\n            }),\n            geometry: new THREE.Geometry()\n          },\n          'function': {\n            material: new THREE.MeshBasicMaterial({\n              color: borderStyle['function']\n            }),\n            geometry: new THREE.Geometry()\n          }\n        };\n      nodes.forEach(function (node) {\n        node.properties.forEach(function (property, i) {\n          var geometry;\n          if (property.type === 'function' || property.type === 'object') {\n            circleMesh.position.set(\n              getX(node), getY(node, i) + 5, 0.2\n            );\n            circleMesh.updateMatrix();\n            meshes[property.type].geometry\n              .merge(circleMesh.geometry, circleMesh.matrix);\n          }\n        });\n      });\n      me.activeScene.add(new THREE.Mesh(\n        meshes.object.geometry, meshes.object.material\n      ));\n      me.activeScene.add(new THREE.Mesh(\n        meshes['function'].geometry, meshes['function'].material\n      ));\n    }\n\n    function generateSpline(f, mid, t, d) {\n      var mult = 0,\n        bumpZ = mid.z * 0.2,\n        fm = new THREE.Vector3()\n          .addVectors(f, mid)\n          .multiplyScalar(0.5)\n          .add(new THREE.Vector3(\n            (mid.x - f.x) * mult,\n            (f.y - mid.y) * mult,\n            bumpZ\n          )),\n        mt = new THREE.Vector3()\n          .addVectors(mid, t)\n          .multiplyScalar(0.5)\n          .add(new THREE.Vector3(\n            (mid.x - t.x) * mult,\n            (t.y - mid.y) * mult,\n            bumpZ\n          ));\n\n      var spline = new THREE.Spline([\n        f, fm, mid, mt, t\n      ]), i, l = 10, index, position,\n        geometry = new THREE.Geometry();\n\n      geometry.colors = [];\n      for (i = 0; i <= l; i += 1) {\n        index = i / l;\n        position = spline.getPoint(index);\n        geometry.vertices[i] = new THREE.Vector3(position.x, position.y, position.z);\n        geometry.colors[i] = new THREE.Color(0xffffff);\n        geometry.colors[i].setHSL(\n          // 200 / 360,\n          // index,\n          // 0.5\n          200/360,\n          1,\n          0.9\n        );\n      }\n      return geometry;\n    }\n\n    function drawEdges(scope) {\n      var me = this,\n        fromV = new THREE.Vector3(),\n        toV = new THREE.Vector3(),\n        mid = new THREE.Vector3();\n\n      edges.forEach(function (link, i) {\n        // console.log(i, edges.length);\n        var from = nodeMap[link.from];\n        var to = nodeMap[link.to];\n\n        var index = _.findIndex(\n          from.properties,\n          { name: link.property }\n        );\n        fromV.set(\n          from.x - from.width * 0.5 + margin.left,\n          from.y - from.height * 0.5 + (from.properties.length - index) * 15 + 5,\n          0\n        );\n        toV.set(\n          to.x - to.width * 0.5,\n          to.y - to.height * 0.5,\n          0\n        );\n        var d = fromV.distanceTo(toV);\n        mid\n          .addVectors(fromV, toV)\n          .multiplyScalar(0.5)\n          .setZ(50);\n\n        var geometry = generateSpline(fromV, mid, toV, d);\n        var material = new THREE.LineBasicMaterial({\n          color: 0xffffff,\n          opacity: 0.5,\n          linewidth: 3,\n          vertexColors: THREE.VertexColors\n        });\n        var mesh = new THREE.Line(geometry, material);\n        me.activeScene.add(mesh);\n      });\n    }\n\n    instance = t3.run({\n      id: id,\n      width: bbox.width,\n      height: bbox.height,\n      theme: 'allWhite',\n      ambientConfig: {\n        ground: false,\n        axes: false,\n        gridY: false,\n        gridX: false,\n        gridZ: false\n      },\n      init: function () {\n        var me = this,\n          rendererEl = me.renderer.domElement;\n        me.datgui.close();\n        me.activeScene.fog = null;\n        me.renderer.sortObjects = false;\n        me.renderer.shadowMapEnabled = true;\n        me.renderer.shadowMapType = THREE.PCFShadowMap;\n\n        var mouse = new THREE.Vector3();\n        var oldIntersected = null;\n        var moved = false, down = false;\n        rendererEl.addEventListener('mousemove', function (e) {\n          if (down) {\n            moved = true;\n            wrapperEl.style.cursor = 'move';\n          } else {\n            moved = false;\n          }\n        });\n        rendererEl.addEventListener('mouseout', function (e) {\n\n        });\n        rendererEl.addEventListener('mousedown', function (e) {\n          down = true;\n        });\n        rendererEl.addEventListener('mouseup', function (e) {\n          down = false;\n          wrapperEl.style.cursor = 'auto';\n        });\n        rendererEl.addEventListener('click', function (e) {\n          e.preventDefault();\n          var bbox = rendererEl.getBoundingClientRect();\n          var cx = e.clientX - bbox.left;\n          var cy = e.clientY - bbox.top;\n          var tween;\n          mouse.x = (cx / rendererEl.clientWidth) * 2 - 1;\n          mouse.y = -(cy / rendererEl.clientHeight) * 2 + 1;\n          var vector = new THREE.Vector3( mouse.x, mouse.y, 0.5 );\n          projector.unprojectVector(vector, me.activeCamera);\n\n          var raycaster = new THREE.Raycaster(\n            camera.position,\n            vector.sub(camera.position).normalize()\n          );\n          var intersects = raycaster.intersectObjects(nodeMeshes),\n            iObject = intersects[0] && intersects[0].object;\n          if (iObject && !moved) {\n            // focus on this object on click\n            // console.log(iObject);\n            var dest = {\n              x: iObject.position.x + iObject.userData.node.width / 2,\n              y: iObject.position.y + iObject.userData.node.height / 2\n            };\n            new TWEEN.Tween(me.activeCamera.position)\n              .to(_.merge({}, dest, {\n                z: iObject.userData.node.height\n              }), 1000)\n              .easing(TWEEN.Easing.Cubic.InOut)\n              .start();\n            new TWEEN.Tween(me.activeCamera.cameraControls.target)\n              .to(dest, 1000)\n              .easing(TWEEN.Easing.Cubic.InOut)\n              .start();\n          }\n        }, false);\n\n        // camera\n        var fov = 70,\n          ratio = rendererEl.clientWidth /\n            rendererEl.clientHeight,\n          near = 1,\n          far = 20000;\n        var camera = new THREE.PerspectiveCamera(fov, ratio, near, far);\n        camera.position.set(\n          data.center.x,\n          data.center.y,\n          Math.min(data.mx.x - data.mn.x, data.mx.y - data.mn.y)\n        );\n        // camera.lookAt(new THREE.Vector3(data.center.x, data.center.y, 0));\n        me\n          .addCamera(camera, 'mine')\n          .setActiveCamera('mine');\n        createCameraControls(camera, rendererEl);\n        camera.cameraControls.target.set(\n          data.center.x,\n          data.center.y,\n          0\n        );\n        camera.cameraControls.noKeys = true;\n\n        // draw the nodes\n        drawNodes.call(me);\n        drawCircles.call(me);\n        drawEdges.call(me);\n      },\n      update: function (delta) {\n        TWEEN.update();\n        var me = this;\n        me.ac = me.ac || 0;\n        me.ac += delta;\n        if (me.ac > 2) {\n          // console.log(me.renderer.info.render);\n          // console.log(me.renderer);\n          me.ac = 0;\n        }\n      }\n    });\n  }\n};","/**\n * @author qiao / https://github.com/qiao\n * @author mrdoob / http://mrdoob.com\n * @author alteredq / http://alteredqualia.com/\n * @author WestLangley / http://github.com/WestLangley\n * @author erich666 / http://erichaines.com\n */\n/*global THREE, console */\n\n// This set of controls performs orbiting, dollying (zooming), and panning. It maintains\n// the \"up\" direction as +Y, unlike the TrackballControls. Touch on tablet and phones is\n// supported.\n//\n//    Orbit - left mouse / touch: one finger move\n//    Zoom - middle mouse, or mousewheel / touch: two finger spread or squish\n//    Pan - right mouse, or arrow keys / touch: three finter swipe\n//\n// This is a drop-in replacement for (most) TrackballControls used in examples.\n// That is, include this js file and wherever you see:\n//      controls = new THREE.TrackballControls( camera );\n//      controls.target.z = 150;\n// Simple substitute \"PanControls\" and the control should work as-is.\n\nTHREE.PanControls = function ( object, domElement ) {\n\n\tthis.object = object;\n\tthis.domElement = ( domElement !== undefined ) ? domElement : document;\n\n\t// API\n\n\t// Set to false to disable this control\n\tthis.enabled = true;\n\n\t// \"target\" sets the location of focus, where the control orbits around\n\t// and where it pans with respect to.\n\tthis.target = new THREE.Vector3();\n\n\t// center is old, deprecated; use \"target\" instead\n\tthis.center = this.target;\n\n\t// This option actually enables dollying in and out; left as \"zoom\" for\n\t// backwards compatibility\n\tthis.noZoom = false;\n\tthis.zoomSpeed = 1.0;\n\n\t// Limits to how far you can dolly in and out\n\tthis.minDistance = 0;\n\tthis.maxDistance = Infinity;\n\n\t// Set to true to disable this control\n\tthis.noRotate = false;\n\tthis.rotateSpeed = 1.0;\n\n\t// Set to true to disable this control\n\tthis.noPan = false;\n\tthis.keyPanSpeed = 7.0;\t// pixels moved per arrow key push\n\n\t// Set to true to automatically rotate around the target\n\tthis.autoRotate = false;\n\tthis.autoRotateSpeed = 2.0; // 30 seconds per round when fps is 60\n\n\t// How far you can orbit vertically, upper and lower limits.\n\t// Range is 0 to Math.PI radians.\n\tthis.minPolarAngle = 0; // radians\n\tthis.maxPolarAngle = Math.PI; // radians\n\n\t// Set to true to disable use of the keys\n\tthis.noKeys = false;\n\n\t// The four arrow keys\n\tthis.keys = { LEFT: 37, UP: 38, RIGHT: 39, BOTTOM: 40 };\n\n\t////////////\n\t// internals\n\n\tvar scope = this;\n\n\tvar EPS = 0.000001;\n\n\tvar rotateStart = new THREE.Vector2();\n\tvar rotateEnd = new THREE.Vector2();\n\tvar rotateDelta = new THREE.Vector2();\n\n\tvar panStart = new THREE.Vector2();\n\tvar panEnd = new THREE.Vector2();\n\tvar panDelta = new THREE.Vector2();\n\tvar panOffset = new THREE.Vector3();\n\n\tvar offset = new THREE.Vector3();\n\n\tvar dollyStart = new THREE.Vector2();\n\tvar dollyEnd = new THREE.Vector2();\n\tvar dollyDelta = new THREE.Vector2();\n\n\tvar phiDelta = 0;\n\tvar thetaDelta = 0;\n\tvar scale = 1;\n\tvar pan = new THREE.Vector3();\n\n\tvar lastPosition = new THREE.Vector3();\n\tvar lastQuaternion = new THREE.Quaternion();\n\n\tvar STATE = { NONE : -1, ROTATE : 0, DOLLY : 1, PAN : 2, TOUCH_ROTATE : 3, TOUCH_DOLLY : 4, TOUCH_PAN : 5 };\n\n\tvar state = STATE.NONE;\n\n\t// for reset\n\n\tthis.target0 = this.target.clone();\n\tthis.position0 = this.object.position.clone();\n\n\t// so camera.up is the orbit axis\n\n\tvar quat = new THREE.Quaternion().setFromUnitVectors( object.up, new THREE.Vector3( 0, 1, 0 ) );\n\tvar quatInverse = quat.clone().inverse();\n\n\t// events\n\n\tvar changeEvent = { type: 'change' };\n\tvar startEvent = { type: 'start'};\n\tvar endEvent = { type: 'end'};\n\n\tthis.rotateLeft = function ( angle ) {\n\n\t\tif ( angle === undefined ) {\n\n\t\t\tangle = getAutoRotationAngle();\n\n\t\t}\n\n\t\tthetaDelta -= angle;\n\n\t};\n\n\tthis.rotateUp = function ( angle ) {\n\n\t\tif ( angle === undefined ) {\n\n\t\t\tangle = getAutoRotationAngle();\n\n\t\t}\n\n\t\tphiDelta -= angle;\n\n\t};\n\n\t// pass in distance in world space to move left\n\tthis.panLeft = function ( distance ) {\n\n\t\tvar te = this.object.matrix.elements;\n\n\t\t// get X column of matrix\n\t\tpanOffset.set( te[ 0 ], te[ 1 ], te[ 2 ] );\n\t\tpanOffset.multiplyScalar( - distance );\n\n\t\tpan.add( panOffset );\n\n\t};\n\n\t// pass in distance in world space to move up\n\tthis.panUp = function ( distance ) {\n\n\t\tvar te = this.object.matrix.elements;\n\n\t\t// get Y column of matrix\n\t\tpanOffset.set( te[ 4 ], te[ 5 ], te[ 6 ] );\n\t\tpanOffset.multiplyScalar( distance );\n\n\t\tpan.add( panOffset );\n\n\t};\n\n\t// pass in x,y of change desired in pixel space,\n\t// right and down are positive\n\tthis.pan = function ( deltaX, deltaY ) {\n\n\t\tvar element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n\t\tif ( scope.object.fov !== undefined ) {\n\n\t\t\t// perspective\n\t\t\tvar position = scope.object.position;\n\t\t\tvar offset = position.clone().sub( scope.target );\n\t\t\tvar targetDistance = offset.length();\n\n\t\t\t// half of the fov is center to top of screen\n\t\t\ttargetDistance *= Math.tan( ( scope.object.fov / 2 ) * Math.PI / 180.0 );\n\n\t\t\t// we actually don't use screenWidth, since perspective camera is fixed to screen height\n\t\t\tscope.panLeft( 2 * deltaX * targetDistance / element.clientHeight );\n\t\t\tscope.panUp( 2 * deltaY * targetDistance / element.clientHeight );\n\n\t\t} else if ( scope.object.top !== undefined ) {\n\n\t\t\t// orthographic\n\t\t\tscope.panLeft( deltaX * (scope.object.right - scope.object.left) / element.clientWidth );\n\t\t\tscope.panUp( deltaY * (scope.object.top - scope.object.bottom) / element.clientHeight );\n\n\t\t} else {\n\n\t\t\t// camera neither orthographic or perspective\n\t\t\tconsole.warn( 'WARNING: PanControls.js encountered an unknown camera type - pan disabled.' );\n\n\t\t}\n\n\t};\n\n\tthis.dollyIn = function ( dollyScale ) {\n\n\t\tif ( dollyScale === undefined ) {\n\n\t\t\tdollyScale = getZoomScale();\n\n\t\t}\n\n\t\tscale /= dollyScale;\n\n\t};\n\n\tthis.dollyOut = function ( dollyScale ) {\n\n\t\tif ( dollyScale === undefined ) {\n\n\t\t\tdollyScale = getZoomScale();\n\n\t\t}\n\n\t\tscale *= dollyScale;\n\n\t};\n\n\tthis.update = function () {\n\n\t\tvar position = this.object.position;\n\n\t\toffset.copy( position ).sub( this.target );\n\n\t\t// rotate offset to \"y-axis-is-up\" space\n\t\toffset.applyQuaternion( quat );\n\n\t\t// angle from z-axis around y-axis\n\n\t\tvar theta = Math.atan2( offset.x, offset.z );\n\n\t\t// angle from y-axis\n\n\t\tvar phi = Math.atan2( Math.sqrt( offset.x * offset.x + offset.z * offset.z ), offset.y );\n\n\t\tif ( this.autoRotate ) {\n\n\t\t\tthis.rotateLeft( getAutoRotationAngle() );\n\n\t\t}\n\n\t\ttheta += thetaDelta;\n\t\tphi += phiDelta;\n\n\t\t// restrict phi to be between desired limits\n\t\tphi = Math.max( this.minPolarAngle, Math.min( this.maxPolarAngle, phi ) );\n\n\t\t// restrict phi to be betwee EPS and PI-EPS\n\t\tphi = Math.max( EPS, Math.min( Math.PI - EPS, phi ) );\n\n\t\tvar radius = offset.length() * scale;\n\n\t\t// restrict radius to be between desired limits\n\t\tradius = Math.max( this.minDistance, Math.min( this.maxDistance, radius ) );\n\n\t\t// move target to panned location\n\t\tthis.target.add( pan );\n\n\t\toffset.x = radius * Math.sin( phi ) * Math.sin( theta );\n\t\toffset.y = radius * Math.cos( phi );\n\t\toffset.z = radius * Math.sin( phi ) * Math.cos( theta );\n\n\t\t// rotate offset back to \"camera-up-vector-is-up\" space\n\t\toffset.applyQuaternion( quatInverse );\n\n\t\tposition.copy( this.target ).add( offset );\n\n\t\tthis.object.lookAt( this.target );\n\n\t\tthetaDelta = 0;\n\t\tphiDelta = 0;\n\t\tscale = 1;\n\t\tpan.set( 0, 0, 0 );\n\n\t\t// update condition is:\n\t\t// min(camera displacement, camera rotation in radians)^2 > EPS\n\t\t// using small-angle approximation cos(x/2) = 1 - x^2 / 8\n\n\t\tif ( lastPosition.distanceToSquared( this.object.position ) > EPS\n\t\t    || 8 * (1 - lastQuaternion.dot(this.object.quaternion)) > EPS ) {\n\n\t\t\tthis.dispatchEvent( changeEvent );\n\n\t\t\tlastPosition.copy( this.object.position );\n\t\t\tlastQuaternion.copy (this.object.quaternion );\n\n\t\t}\n\n\t};\n\n\n\tthis.reset = function () {\n\n\t\tstate = STATE.NONE;\n\n\t\tthis.target.copy( this.target0 );\n\t\tthis.object.position.copy( this.position0 );\n\n\t\tthis.update();\n\n\t};\n\n\tfunction getAutoRotationAngle() {\n\n\t\treturn 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;\n\n\t}\n\n\tfunction getZoomScale() {\n\n\t\treturn Math.pow( 0.95, scope.zoomSpeed );\n\n\t}\n\n\tfunction onMouseDown( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\t\tevent.preventDefault();\n\n\t\tif ( event.button === 2 ) {\n\t\t\tif ( scope.noRotate === true ) return;\n\n\t\t\tstate = STATE.ROTATE;\n\n\t\t\trotateStart.set( event.clientX, event.clientY );\n\n\t\t} else if ( event.button === 1 ) {\n\t\t\tif ( scope.noZoom === true ) return;\n\n\t\t\tstate = STATE.DOLLY;\n\n\t\t\tdollyStart.set( event.clientX, event.clientY );\n\n\t\t} else if ( event.button === 0 ) {\n\t\t\tif ( scope.noPan === true ) return;\n\n\t\t\tstate = STATE.PAN;\n\n\t\t\tpanStart.set( event.clientX, event.clientY );\n\n\t\t}\n\n\t\tdocument.addEventListener( 'mousemove', onMouseMove, false );\n\t\tdocument.addEventListener( 'mouseup', onMouseUp, false );\n\t\tscope.dispatchEvent( startEvent );\n\n\t}\n\n\tfunction onMouseMove( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\n\t\tvar element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n\t\tif ( state === STATE.ROTATE ) {\n\n\t\t\tif ( scope.noRotate === true ) return;\n\n\t\t\trotateEnd.set( event.clientX, event.clientY );\n\t\t\trotateDelta.subVectors( rotateEnd, rotateStart );\n\n\t\t\t// rotating across whole screen goes 360 degrees around\n\t\t\tscope.rotateLeft( 2 * Math.PI * rotateDelta.x / element.clientWidth * scope.rotateSpeed );\n\n\t\t\t// rotating up and down along whole screen attempts to go 360, but limited to 180\n\t\t\tscope.rotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight * scope.rotateSpeed );\n\n\t\t\trotateStart.copy( rotateEnd );\n\n\t\t} else if ( state === STATE.DOLLY ) {\n\n\t\t\tif ( scope.noZoom === true ) return;\n\n\t\t\tdollyEnd.set( event.clientX, event.clientY );\n\t\t\tdollyDelta.subVectors( dollyEnd, dollyStart );\n\n\t\t\tif ( dollyDelta.y > 0 ) {\n\n\t\t\t\tscope.dollyIn();\n\n\t\t\t} else {\n\n\t\t\t\tscope.dollyOut();\n\n\t\t\t}\n\n\t\t\tdollyStart.copy( dollyEnd );\n\n\t\t} else if ( state === STATE.PAN ) {\n\n\t\t\tif ( scope.noPan === true ) return;\n\n\t\t\tpanEnd.set( event.clientX, event.clientY );\n\t\t\tpanDelta.subVectors( panEnd, panStart );\n\n\t\t\tscope.pan( panDelta.x, panDelta.y );\n\n\t\t\tpanStart.copy( panEnd );\n\n\t\t}\n\n\t\tscope.update();\n\n\t}\n\n\tfunction onMouseUp( /* event */ ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tdocument.removeEventListener( 'mousemove', onMouseMove, false );\n\t\tdocument.removeEventListener( 'mouseup', onMouseUp, false );\n\t\tscope.dispatchEvent( endEvent );\n\t\tstate = STATE.NONE;\n\n\t}\n\n\tfunction onMouseWheel( event ) {\n\n\t\tif ( scope.enabled === false || scope.noZoom === true ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tvar delta = 0;\n\n\t\tif ( event.wheelDelta !== undefined ) { // WebKit / Opera / Explorer 9\n\n\t\t\tdelta = event.wheelDelta;\n\n\t\t} else if ( event.detail !== undefined ) { // Firefox\n\n\t\t\tdelta = - event.detail;\n\n\t\t}\n\n\t\tif ( delta > 0 ) {\n\n\t\t\tscope.dollyOut();\n\n\t\t} else {\n\n\t\t\tscope.dollyIn();\n\n\t\t}\n\n\t\tscope.update();\n\t\tscope.dispatchEvent( startEvent );\n\t\tscope.dispatchEvent( endEvent );\n\n\t}\n\n\tfunction onKeyDown( event ) {\n\n\t\tif ( scope.enabled === false || scope.noKeys === true || scope.noPan === true ) return;\n\n\t\tswitch ( event.keyCode ) {\n\n\t\t\tcase scope.keys.UP:\n\t\t\t\tscope.pan( 0, scope.keyPanSpeed );\n\t\t\t\tscope.update();\n\t\t\t\tbreak;\n\n\t\t\tcase scope.keys.BOTTOM:\n\t\t\t\tscope.pan( 0, - scope.keyPanSpeed );\n\t\t\t\tscope.update();\n\t\t\t\tbreak;\n\n\t\t\tcase scope.keys.LEFT:\n\t\t\t\tscope.pan( scope.keyPanSpeed, 0 );\n\t\t\t\tscope.update();\n\t\t\t\tbreak;\n\n\t\t\tcase scope.keys.RIGHT:\n\t\t\t\tscope.pan( - scope.keyPanSpeed, 0 );\n\t\t\t\tscope.update();\n\t\t\t\tbreak;\n\n\t\t}\n\n\t}\n\n\tfunction touchstart( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tswitch ( event.touches.length ) {\n\n\t\t\tcase 1:\t// one-fingered touch: rotate\n\n\t\t\t\tif ( scope.noRotate === true ) return;\n\n\t\t\t\tstate = STATE.TOUCH_ROTATE;\n\n\t\t\t\trotateStart.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n\t\t\t\tbreak;\n\n\t\t\tcase 2:\t// two-fingered touch: dolly\n\n\t\t\t\tif ( scope.noZoom === true ) return;\n\n\t\t\t\tstate = STATE.TOUCH_DOLLY;\n\n\t\t\t\tvar dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n\t\t\t\tvar dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n\t\t\t\tvar distance = Math.sqrt( dx * dx + dy * dy );\n\t\t\t\tdollyStart.set( 0, distance );\n\t\t\t\tbreak;\n\n\t\t\tcase 3: // three-fingered touch: pan\n\n\t\t\t\tif ( scope.noPan === true ) return;\n\n\t\t\t\tstate = STATE.TOUCH_PAN;\n\n\t\t\t\tpanStart.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tstate = STATE.NONE;\n\n\t\t}\n\n\t\tscope.dispatchEvent( startEvent );\n\n\t}\n\n\tfunction touchmove( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tvar element = scope.domElement === document ? scope.domElement.body : scope.domElement;\n\n\t\tswitch ( event.touches.length ) {\n\n\t\t\tcase 1: // one-fingered touch: rotate\n\n\t\t\t\tif ( scope.noRotate === true ) return;\n\t\t\t\tif ( state !== STATE.TOUCH_ROTATE ) return;\n\n\t\t\t\trotateEnd.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n\t\t\t\trotateDelta.subVectors( rotateEnd, rotateStart );\n\n\t\t\t\t// rotating across whole screen goes 360 degrees around\n\t\t\t\tscope.rotateLeft( 2 * Math.PI * rotateDelta.x / element.clientWidth * scope.rotateSpeed );\n\t\t\t\t// rotating up and down along whole screen attempts to go 360, but limited to 180\n\t\t\t\tscope.rotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight * scope.rotateSpeed );\n\n\t\t\t\trotateStart.copy( rotateEnd );\n\n\t\t\t\tscope.update();\n\t\t\t\tbreak;\n\n\t\t\tcase 2: // two-fingered touch: dolly\n\n\t\t\t\tif ( scope.noZoom === true ) return;\n\t\t\t\tif ( state !== STATE.TOUCH_DOLLY ) return;\n\n\t\t\t\tvar dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n\t\t\t\tvar dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n\t\t\t\tvar distance = Math.sqrt( dx * dx + dy * dy );\n\n\t\t\t\tdollyEnd.set( 0, distance );\n\t\t\t\tdollyDelta.subVectors( dollyEnd, dollyStart );\n\n\t\t\t\tif ( dollyDelta.y > 0 ) {\n\n\t\t\t\t\tscope.dollyOut();\n\n\t\t\t\t} else {\n\n\t\t\t\t\tscope.dollyIn();\n\n\t\t\t\t}\n\n\t\t\t\tdollyStart.copy( dollyEnd );\n\n\t\t\t\tscope.update();\n\t\t\t\tbreak;\n\n\t\t\tcase 3: // three-fingered touch: pan\n\n\t\t\t\tif ( scope.noPan === true ) return;\n\t\t\t\tif ( state !== STATE.TOUCH_PAN ) return;\n\n\t\t\t\tpanEnd.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n\t\t\t\tpanDelta.subVectors( panEnd, panStart );\n\n\t\t\t\tscope.pan( panDelta.x, panDelta.y );\n\n\t\t\t\tpanStart.copy( panEnd );\n\n\t\t\t\tscope.update();\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tstate = STATE.NONE;\n\n\t\t}\n\n\t}\n\n\tfunction touchend( /* event */ ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tscope.dispatchEvent( endEvent );\n\t\tstate = STATE.NONE;\n\n\t}\n\n\tthis.domElement.addEventListener( 'contextmenu', function ( event ) { event.preventDefault(); }, false );\n\tthis.domElement.addEventListener( 'mousedown', onMouseDown, false );\n\tthis.domElement.addEventListener( 'mousewheel', onMouseWheel, false );\n\tthis.domElement.addEventListener( 'DOMMouseScroll', onMouseWheel, false ); // firefox\n\n\tthis.domElement.addEventListener( 'touchstart', touchstart, false );\n\tthis.domElement.addEventListener( 'touchend', touchend, false );\n\tthis.domElement.addEventListener( 'touchmove', touchmove, false );\n\n\twindow.addEventListener( 'keydown', onKeyDown, false );\n\n\t// force an update at start\n\tthis.update();\n\n};\n\nTHREE.PanControls.prototype = Object.create( THREE.EventDispatcher.prototype );\n","var d3 = (typeof window !== \"undefined\" ? window.d3 : typeof global !== \"undefined\" ? global.d3 : null),\n  _ = require('lodash'),\n  utils = require('../../util/'),\n  pojoVizNode = require('./Node');\n\nvar svg = d3.select('svg#canvas');\nvar prefix = utils.prefixer;\nvar escapeCls = utils.escapeCls;\nvar transformProperty = utils.transformProperty;\n\nfunction getX(d) {\n  return d.x - d.width / 2;\n}\n\nfunction getY(d) {\n  return d.y - d.height / 2;\n}\n\nfunction Canvas(data) {\n  this.id = _.uniqueId();\n  this.data = data;\n  this.createRoot();\n  this.set({\n    nodes: data.nodes,\n    edges: data.edges\n  });\n}\n\nCanvas.prototype.destroy = function() {\n  this.data = null;\n  svg.attr('style', 'display: none');\n  svg\n    .selectAll('*')\n    .remove();\n};\n\nCanvas.prototype.createRoot = function() {\n  svg.attr('style', '');\n  this.root = svg\n    .append('g')\n      .attr('class', 'root-' + this.id);\n};\n\nCanvas.prototype.set = function(obj, render) {\n  this.nodes = obj.nodes;\n  this.edges = obj.edges;\n  if (render) {\n    this.render();\n  }\n};\n\nCanvas.prototype.fixZoom = function() {\n  var me = this,\n      scr = svg.node(),\n      bbox = this.root.node().getBBox(),\n      screenWidth = scr.clientWidth,\n      screenHeight = scr.clientHeight,\n      canvasWidth = bbox.width,\n      canvasHeight = bbox.height,\n      sx = this.data.mn.x,\n      sy = this.data.mn.y,\n      scale = Math.min(\n        screenWidth / canvasWidth,\n        screenHeight / canvasHeight\n      ),\n      translate;\n\n  if (!isFinite(scale)) {\n    scale = 0;\n  }\n  // change the scale proportionally to its proximity to zero\n  scale -= scale / 10;\n\n  translate = [\n    -sx * scale + (screenWidth / 2 -\n      canvasWidth * scale / 2),\n    -sy * scale + (screenHeight / 2 -\n      canvasHeight * scale / 2),\n  ];\n\n  function redraw() {\n    var translation = d3.event.translate,\n        newX = translation[0],\n        newY = translation[1];\n    me.root.attr('transform',\n      utils.transform({\n        translate: [newX, newY],\n        scale: [d3.event.scale]\n      })\n    );\n  }\n\n  function zoomBehavior(type) {\n    var start = type === 'start';\n    return function () {\n      d3.select(this).classed('dragged', start);\n    };\n  }\n\n  // console.log('center', translate);\n  // console.log(scr.clientWidth, bbox.width, sx);\n  var zoom = d3.behavior.zoom()\n    .on('zoomstart', zoomBehavior('start'))\n    .on('zoom', redraw)\n    .on('zoomend', zoomBehavior('end'))\n    .translate(translate)\n    .scale(scale);\n\n  svg.call(zoom);\n\n  me.root\n    .attr('transform', utils.transform({\n      scale: [scale],\n      translate: [\n        -sx + (screenWidth / scale / 2 - canvasWidth / 2),\n        -sy + (screenHeight / scale / 2 - canvasHeight / 2)\n      ]\n    }))\n    .attr('opacity', 0)\n    .transition()\n    .duration(500)\n    .attr('opacity', 1);\n};\n\nCanvas.prototype.render = function() {\n  this.renderNodes();\n  this.renderEdges();\n  this.fixZoom();\n};\n\nCanvas.prototype.renderEdges = function() {\n  var me = this,\n      edges = this.edges;\n\n  // CREATE\n  var diagonal = d3.svg.diagonal()\n  .source(function(d) {\n    var from = me.root.select('.' +\n          prefix(escapeCls(d.from))\n        );\n    if (!from.node()) {\n      throw 'source node must exist';\n    }\n    var fromData = from.datum(),\n        property = from.select('.' + prefix(\n          escapeCls(transformProperty(d.property))\n        )),\n        propertyData = d3.transform(property.attr('transform'));\n\n    return {\n      x: getY(fromData) + propertyData.translate[1] - 2,\n      y: getX(fromData) + propertyData.translate[0] - 10\n    };\n  })\n  .target(function(d) {\n    var to = me.root.select('.' +\n          prefix(escapeCls(d.to))\n        ),\n        toData, bbox;\n    if (!to.node()) {\n      throw 'target node must exist';\n    }\n    toData = to.datum();\n    bbox = to.node().getBBox();\n    return {\n      x: getY(toData) + 10,// + bbox.height / 2,\n      y: getX(toData)// + bbox.width / 2\n    };\n  })\n  .projection(function(d) {\n    return [d.y, d.x];\n  });\n\n  function mouseEvent(type) {\n    var over = type === 'over';\n    return function (d) {\n      d3.select(this)\n        .classed('selected', over);\n    };\n  }\n\n  var e = this.root.selectAll('.link')\n      .data(edges)\n    .enter()\n      .append('path')\n      .attr('class', function (d) {\n        return [\n          prefix('to', escapeCls(d.to)),\n          prefix('from', escapeCls(d.from)),\n          prefix('link')\n        ].join(' ');\n      })\n      .attr('stroke', 'lightgray')\n      .attr('stroke-opacity', 0.3)\n      .attr('d', diagonal)\n      .on('mouseover', mouseEvent('over'))\n      .on('mouseout', mouseEvent('out'));\n};\n\nCanvas.prototype.opacityToggle = function(decrease) {\n  this.root\n    .classed(prefix('nodes-focused'), decrease);\n};\n\nCanvas.prototype.renderNodes = function() {\n  var nodes = this.nodes;\n\n  var nodeCtor = pojoVizNode(this);\n  nodeCtor.margin({\n    top: 10,\n    left: 10,\n    right: 10,\n    bottom: 10\n  });\n  var nodeGroup = this.root.selectAll(prefix('node'))\n    .data(nodes)\n    .call(nodeCtor);\n};\n\nmodule.exports = Canvas;","'use strict';\n\nvar _ = require('lodash');\n\nvar propertiesTransformation = {\n  '[[Prototype]]': '__proto__'\n};\n\nvar utils = {\n  assert: function (v, message) {\n    if (!v) {\n      throw message || 'error';\n    }\n  },\n  translate: function (x, y) {\n    return 'translate(' + (x || 0) + ', ' + (y || 0) + ')';\n  },\n  scale: function (s) {\n    return 'scale(' + (s || 1) + ')';\n  },\n  transform: function (obj) {\n    var t = [];\n    _.forOwn(obj, function (v, k) {\n      t.push(utils[k].apply(utils, v));\n    });\n    return t.join(' ');\n  },\n  prefixer: function () {\n    var args = [].slice.call(arguments);\n    args.unshift('pv');\n    return args.join('-');\n  },\n  transformProperty: function (v) {\n    if (propertiesTransformation.hasOwnProperty(v)) {\n      return propertiesTransformation[v];\n    }\n    return v;\n  },\n  escapeCls: function(v) {\n    return v.replace(/\\$/g, '_');\n  },\n  toQueryString: function (obj) {\n    var s = '',\n        i = 0;\n    _.forOwn(obj, function (v, k) {\n      if (i) {\n        s += '&';\n      }\n      s += k + '=' + v;\n      i += 1;\n    });\n    return s;\n  },\n  createEvent: function (eventName, details) {\n    return new CustomEvent(eventName, {\n      detail: details\n    });\n  },\n  notification: function (message, consoleToo) {\n    var ev = utils.createEvent('pojoviz-notification', message);\n    consoleToo && console.log(message);\n    document.dispatchEvent(ev);\n  },\n  createJsonpCallback: function (url) {\n    var script = document.createElement('script');\n    script.src = url;\n    document.head.appendChild(script);\n  }\n};\n\nmodule.exports = utils;","var _ = require('lodash'),\n  d3 = (typeof window !== \"undefined\" ? window.d3 : typeof global !== \"undefined\" ? global.d3 : null),\n  utils = require('../../util/'),\n  pojoVizProperty = require('./Property'),\n  hashKey = require('../../util/hashKey');\n\nvar prefix = utils.prefixer;\nvar escapeCls = utils.escapeCls;\nvar margin = { top: 0, right: 0, left: 0, bottom: 0 };\n\nfunction Node(parent) {\n\n  function my(selection) {\n    // create\n    var enter = selection.enter();\n\n    function groupMouseBehavior(type) {\n      var over = type === 'over';\n      return function (d, i) {\n        var labelEscaped = escapeCls(d.label);\n\n        // hide all\n        parent.opacityToggle(over);\n\n        // select links\n        d3.selectAll('.' + prefix('to', labelEscaped))\n          .classed('selected predecessor', over);\n        d3.selectAll('.' + prefix('from', labelEscaped))\n          .classed('selected successor', over);\n\n        // select current node\n        d3.select('.' + prefix(labelEscaped))\n          .classed('selected current', over);\n\n        // select predecessor nodes\n        d.predecessors\n          .forEach(function (v) {\n            d3.selectAll('.' + prefix(escapeCls(v)))\n              .classed('selected predecessor', over);\n          });\n\n        // select successor nodes\n        d.successors\n          .forEach(function (v) {\n            d3.selectAll('.' + prefix(escapeCls(v)))\n              .classed('selected successor', over);\n          });\n      };\n    }\n\n    var nodeEnter = enter\n      .append('g')\n      .attr('class', function (d) {\n        var type = d.label\n          .match(/^(\\w)*/);\n        return [\n          prefix('node'),\n          prefix(type[0]),\n          prefix(escapeCls(d.label))\n        ].join(' ');\n      })\n      .attr('transform', function (d) {\n        return utils.translate(\n          d.x - d.width / 2,\n          d.y - d.height / 2\n        );\n      })\n      .on('mouseover', groupMouseBehavior('over'))\n      .on('mouseout', groupMouseBehavior('out'));\n\n    nodeEnter\n      .append('rect')\n      .attr('rx', 5)\n      .attr('ry', 5)\n      .attr('class', 'node-background');\n\n    nodeEnter\n      // .append('g')\n      .append('text')\n        .attr('class', prefix('title'))\n        .attr('transform', 'translate(20, 25)')\n        .text(function (d) {\n          var name = d.label\n            .match(/\\S*?-(.*)/)[1]\n            .replace('-', '.');\n          return name;\n        });\n\n    // nodeEnter\n    //   .append('text')\n    //     .attr('class', 'title')\n    //     .text(function (d) { return d.label; });\n\n    var bodyEnter = nodeEnter\n      .append('g')\n        .attr('class', prefix('body'));\n\n    var propertyCtor = pojoVizProperty();\n    propertyCtor.margin(margin);\n    bodyEnter.selectAll('g.' + prefix('property'))\n      .data(function (d) {\n        d.properties.forEach(function (p) {\n          p.label = d.label;\n        });\n        return d.properties;\n      })\n      .call(propertyCtor);\n\n    // fix node background width/height\n    selection.each(function (d, i) {\n      var el = d3.select(this),\n          rect = el.select('rect.node-background');\n\n      // setTimeout(function () {\n      var bbox = el.node().getBBox();\n      rect\n        .attr('width', bbox.width + 10 * 2)\n        .attr('height', bbox.height + 10);\n      // }, 0);\n    });\n  }\n  my.margin = function (m) {\n    if (!m) {\n      return margin;\n    }\n    margin = _.merge(margin, m);\n  };\n  return my;\n}\n\nmodule.exports = Node;","'use strict';\n\nvar _ = require('lodash'),\n  assert = require('./').assert,\n  me, hashKey;\n\nfunction isObjectOrFunction(v) {\n  return v && (typeof v === 'object' || typeof v === 'function');\n}\n\n/**\n * Gets a store hashkey only if it's an object\n * @param  {[type]} obj\n * @return {[type]}\n */\nfunction get(obj) {\n  assert(isObjectOrFunction(obj), 'obj must be an object|function');\n  return obj.hasOwnProperty &&\n    obj.hasOwnProperty(me.hiddenKey) &&\n    obj[me.hiddenKey];\n}\n\n/**\n * Sets a key on an object\n * @param {[type]} obj [description]\n * @param {[type]} key [description]\n */\nfunction set(obj, key) {\n  assert(isObjectOrFunction(obj), 'obj must be an object|function');\n  assert(\n    key && typeof key === 'string',\n    'The key needs to be a valid string'\n  );\n  if (!get(obj)) {\n    Object.defineProperty(obj, me.hiddenKey, {\n      value: typeof obj + '-' + key\n    });\n  }\n  return me;\n}\n\nme = hashKey = function (v) {\n  var value = v,\n      uid = v;\n\n  if (isObjectOrFunction(v)) {\n    if (!get(v)) {\n      me.createHashKeysFor(v);\n    }\n    uid = get(v);\n    if (!uid) {\n      console.err('no hashkey :(', v);\n    }\n    assert(uid, 'error getting the key');\n    return uid;\n  }\n\n  // v is a primitive\n  return typeof v + '-' + uid;\n};\nme.hiddenKey = '__pojoVizKey__';\n\nme.createHashKeysFor = function (obj, name) {\n\n  function localToString(obj) {\n    var match;\n    try {\n      match = {}.toString.call(obj).match(/^\\[object (\\S*?)\\]/);\n    } catch (e) {\n      match = false;\n    }\n    return match && match[1];\n  }\n\n  /**\n   * Analyze the internal property [[Class]] to guess the name\n   * of this object, e.g. [object Date], [object Math]\n   * Many object will give false positives (they will match [object Object])\n   * so let's consider Object as the name only if it's equal to\n   * Object.prototype\n   * @param  {Object}  obj\n   * @return {Boolean}\n   */\n  function hasAClassName(obj) {\n    var match = localToString(obj);\n    if (match === 'Object') {\n      return obj === Object.prototype && 'Object';\n    }\n    return match;\n  }\n\n  function getName(obj) {\n    var name, className;\n\n    // return the already generated hashKey\n    if (get(obj)) {\n      return get(obj);\n    }\n\n    // generate a new key based on\n    // - the name if it's a function\n    // - a unique id\n    name = typeof obj === 'function' &&\n      typeof obj.name === 'string' &&\n      obj.name;\n\n    className = hasAClassName(obj);\n    if (!name && className) {\n      name = className;\n    }\n\n    name = name || _.uniqueId();\n    name = name.replace(/[\\. ]/img, '-');\n    return name;\n  }\n\n  // the name is equal to the passed name or the\n  // generated name\n  name = name || getName(obj);\n\n  // if the obj is a prototype then try to analyze\n  // the constructor first so that the prototype becomes\n  // [name].prototype\n  // special case: object.constructor = object\n  if (obj.hasOwnProperty &&\n      obj.hasOwnProperty('constructor') &&\n      typeof obj.constructor === 'function' &&\n      obj.constructor !== obj) {\n    me.createHashKeysFor(obj.constructor);\n  }\n\n  // set name on self\n  set(obj, name);\n\n  // set name on the prototype\n  if (typeof obj === 'function' &&\n      obj.hasOwnProperty('prototype')) {\n    set(obj.prototype, name + '-prototype');\n  }\n};\n\nme.has = function (v) {\n  return v.hasOwnProperty &&\n    v.hasOwnProperty(me.hiddenKey);\n};\n\nmodule.exports = me;","var d3 = (typeof window !== \"undefined\" ? window.d3 : typeof global !== \"undefined\" ? global.d3 : null),\n  _ = require('lodash'),\n  utils = require('../../util/');\n\nvar prefix = utils.prefixer;\nvar escapeCls = utils.escapeCls;\nvar transformProperty = utils.transformProperty;\n\nfunction Property() {\n  var margin = {\n    top: 0,\n    right: 0,\n    bottom: 0,\n    left: 0\n  };\n\n  var titleHeight = 40;\n\n  function my(selection) {\n\n    function propertyY(d, i) {\n      return [\n        margin.left + 10,\n        margin.top + titleHeight + i * 15\n      ];\n    }\n\n    // PROPERTY CREATE\n    function mouseEvent(type) {\n      var over = type === 'over';\n      return function (d, i) {\n        d3.select(this)\n          .transition()\n            .duration(300)\n            .attr('transform', function () {\n              return utils.transform({\n                translate: propertyY(d, i),\n                scale: [over ? 1.5 : 1]\n              });\n            });\n      };\n    }\n    var propertyEnter = selection.enter()\n        .append('g')\n        .attr('class', function (d) {\n          return [\n            prefix('property'),\n            prefix(\n              escapeCls(transformProperty(d.name))\n            )\n          ].join(' ');\n        })\n        .attr('transform', function (d, i) {\n          return utils.transform({\n            translate: propertyY(d, i)\n          });\n        })\n        .on('mouseover', mouseEvent('over'))\n        .on('mouseout', mouseEvent('out'));\n\n    propertyEnter\n      .append('text')\n      .attr('font-size', 10)\n      .attr('text-anchor', 'start')\n      .attr('class', function (d) {\n        return [\n          prefix('key')\n        ].join(' ');\n      })\n      .text(function (d, i) {\n        return d.name;\n      })\n      .on('click', function (d, i) {\n        console.log(d);\n        var link = d.label.match(/\\S*?-([\\$\\w-\\.]*)/);\n        var ev = new CustomEvent('property-click', {\n          detail: {\n            name: link[1],\n            property: d.name\n          }\n        });\n        console.log(ev.detail);\n        document.dispatchEvent(ev);\n      });\n\n    var rectWrap = propertyEnter\n      .insert('rect', 'text')\n      .attr('class', function (d) {\n        return [\n          prefix(d.type),\n          prefix('property', 'background')\n        ].join(' ');\n      })\n      .attr('rx', 3)\n      .attr('ry', 3)\n      .attr('x', -2)\n      .attr('y', -9);\n\n    selection.selectAll('rect.' + prefix('property', 'background'))\n      .each(function (d) {\n        var me = d3.select(this)\n          .attr('height', function (d) {\n            var text = d3\n              .select(this.parentNode)\n              .select('text');\n            return text.property('clientHeight');\n          })\n          .attr('width', function (d) {\n            var text = d3\n              .select(this.parentNode)\n              .select('text');\n            return text.property('clientWidth') + 3;\n          });\n      });\n\n    propertyEnter.each(function (d) {\n      if (d.type === 'object' || d.type === 'function') {\n        d3.select(this)\n          .append('circle')\n          .attr('r', 4)\n          .attr('class', prefix('dot-' + d.type))\n          .attr('cx', -10)\n          .attr('cy', -2)\n          .attr('opacity', 1);\n      }\n    });\n  }\n  my.margin = function (m) {\n    if (!m) {\n      return margin;\n    }\n    margin = _.merge(margin, m);\n  };\n  return my;\n}\n\nmodule.exports = Property;"]}