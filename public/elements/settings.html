<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/paper-slider/paper-slider.html">
<link rel="import" href="../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../bower_components/paper-radio-button/paper-radio-button.html">

<polymer-element name="pojoviz-settings">
	<template>
		<style>
			paper-checkbox, paper-radio-button {
				padding: 20px 40px 20px 0;
			}
			paper-slider {
				width: 100%;
				max-width: 1000px;
			}
			.depth-value {
				padding-left: 20px;
				color: #bbb;
			}
			.service-name {
				padding-right: 50px;
			}
		</style>

		<section>
			<h1>General Settings</h1>

			<h3>Renderers</h3>

			<paper-radio-group
				target="{{$.renderers}}"
				itemsSelector="paper-radio-button"
				on-core-select="{{onRadioSelectChange}}"
				selected="0">

				<div id="renderers">
					<div horizontal layout>
						<paper-radio-button
				    	name="d3"
				    	value="d3">
				    </paper-radio-button>
				    <div vertical layout>
				      <h4>D3 renderer</h4>
				      <div>
				      	The recommended renderer for small structures, if you see the application unresponsive maybe you can use the three.js renderer
								<p>Controls:</p>
				      	<ul>
				      		<li>hover on a node: show its connections</li>
				      		<li>left click + drag: pan</li>
				      		<li>mouse wheel: zoom</li>
				      	</ul>
				      </div>
				    </div>
				  </div>
					<div horizontal layout>
						<paper-radio-button
				    	name="Three.js"
				    	value="three">
				    </paper-radio-button>
				    <div vertical layout>
				      <h4>Three js renderer (experimental)</h4>
				      <div>
				      	The d3 renderer generates so many nodes for some libraries
				      	that it becomes unresponsive, luckily the structure generated by <span class="pojoviz">PojoViz</span> is a simple collection of nodes and edges which can be rendered with three.js as well :)
				      	<p>Controls:</p>
				      	<ul>
				      		<li>mouse wheel: zoom</li>
				      		<li>click on a node: focus that node</li>
				      		<li>left click + drag: pan</li>
				      		<li>right click + drag: rotate</li>
				      	</ul>
				      </div>
				    </div>
				  </div>
				</div>
			</paper-radio-group>

			<h3>Additional options</h3>
			<div horizontal layout>
                <paper-checkbox on-change="{{onShowBuiltInChange}}"></paper-checkbox>
                <div vertical layout>
                  <h4>Generate links to BuiltIn Objects</h4>
                  <div>Most of the objects will have their [[<kbd>Prototype</kbd>]] property pointing to <kbd>Object.prototype</kbd> as well as the functions' [[<kbd>Prototype</kbd>]] pointing to <kbd>Function.prototype</kbd>. This feature is disabled because of the number of links created to these objects, check to enable this feature.</div>
                </div>
            </div>

            <div horizontal layout>
                <paper-checkbox checked="true" on-change="{{onFunctionConstructorsChange}}"></paper-checkbox>
                <div vertical layout>
                    <h4>Function Constructors visibility</h4>
                    <div>Something really hard to detect is when a function is a constructor, to <span class="pojoviz">PojoViz</span> a function is a constructor when:
                        <ul>
                            <li>the function has a <kbd>name</kbd> property which starts with an uppercase letter</li>
                            <li>if an object has a property which starts with an uppercase letter and this property is a function</li>
                        </ul>
                    </div>
                </div>
            </div>
		</section>

		<section>
			<h3>
				Window max depth
				<span class="depth-value">{{$.windowDepth.value}}</span>
			</h3>
			<p>
				Defines the maximum depth when running the dfs algorithm starting from the <i>window</i> object <br />
				WARNING: The higher the value the longer the time needed for the browser to render the nodes
			</p>
			<paper-slider on-change="{{windowDepthChange}}" id="windowDepth" pin snaps max="10" step="1" value="1">
			</paper-slider>
		</section>

		<!--<section>-->
			<!--<h3>-->
				<!--ExtJS max depth-->
				<!--<span class="depth-value">{{$.extDepth.value}}</span>-->
			<!--</h3>-->
			<!--<p>-->
				<!--Defines the maximum depth when running the dfs algorithm starting from the <i>Ext</i> object <br />-->
				<!--WARNING: The higher the value the longer the time needed for the browser to render the nodes-->
			<!--</p>-->
			<!--<paper-slider on-change="{{extDepthChange}}" id="extDepth" pin snaps max="10" step="1" value="3">-->
			<!--</paper-slider>-->
		<!--</section>-->

		<section>
			<h3>Angular drawer settings</h3>
			<p>
				Select ng module services to be drawn
			</p>
			<div layout wrap horizontal>
				<template repeat="{{ service in angularServices }}">
					<div class="angular-service" horizontal center layout style="width: 300px">
						<div flex class="service-name"> {{ service.name }} </div>
						<paper-checkbox checked="{{service.checked}}"></paper-checkbox>
					</div>
				</template>
			</div>
		</section>

		<content></content>

	</template>
	<script>
		Polymer('pojoviz-settings', {
			ready: function () {
				var me = this,
					angularAnalyzer = pojoviz.InspectedInstances.angular;
				me.angularServices = angularAnalyzer.services;
			},

			windowDepthChange: function (event, detail, el) {
				var windowInspector = pojoviz.InspectedInstances.window;
                // clears the canvas on the next execution
                pojoviz.unsetInspector();
                windowInspector.setDirty();
                windowInspector.analyzer.reset();
                windowInspector.analyzer.levels = el.value;
			},

			onShowBuiltInChange: function (ev, detail, el) {
                // clears the canvas on the next execution
                pojoviz.unsetInspector();
                // with all the inspected instances:
                // - make it dirty
                // - reset any info the analyzer might have
                pojoviz.InspectedInstances
                    .all(function (v) {
                        v.analyzer.reset();
                        v.setBuiltInVisibility(!el.checked);
                    })
					.setDirty();
                // with new instances update the default info
                pojoviz.analyzer.Inspector
                    .setBuiltInVisibility(!el.checked);
			},

			onFunctionConstructorsChange: function (ev, detail, el) {
                // clears the canvas on the next execution
                pojoviz.unsetInspector();
                // with all the inspected instances:
                // - make it dirty
                // - reset any info the analyzer might have
                pojoviz.InspectedInstances
                        .all(function (v) {
                            v.analyzer.reset();
                            v.analyzer.visitConstructors = el.checked;
                        })
                        .setDirty();
                // TODO: set the same config for new instances to be created
                // just like onShowBuiltInChange
            },

			onRadioSelectChange: function (ev, detail, el) {
				if (detail.isSelected) {
                    // update the renderer
					pojoviz.draw.setRenderer(detail.item.getAttribute('value'));
				} else {
                    // radio deselected
                    // means that we have to clear this renderer
                    pojoviz.draw.getRenderer().clear();
                }
			}
		});
	</script>
</polymer-element>