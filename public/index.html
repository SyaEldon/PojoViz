<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Pojo Viz</title>

	<script src="bower_components/platform/platform.js"></script>

  <!-- Meta -->
  <meta content="PojoViz" property="og:title">
  <meta content="PojoViz - visualize your code" name="description">

	<link rel="import" href="bower_components/core-scaffold/core-scaffold.html">
	<link rel="import" href="bower_components/core-toolbar/core-toolbar.html">
	<link rel="import" href="bower_components/core-menu/core-menu.html">
	<link rel="import" href="bower_components/core-menu/core-submenu.html">
	<link rel="import" href="bower_components/core-item/core-item.html">
	<link rel="import" href="bower_components/core-animated-pages/core-animated-pages.html">
	<link rel="import" href="bower_components/core-animated-pages/transitions/cross-fade.html">
	<link rel="import" href="bower_components/core-tooltip/core-tooltip.html">
	<link rel="import" href="bower_components/core-icon/core-icon.html">
	<link rel="import" href="bower_components/paper-toast/paper-toast.html">

	<link rel="import" href="elements/settings.html">
	<link rel="import" href="elements/about.html">
	<link rel="import" href="elements/search.html">
	<link rel="import" href="elements/userMenu.html">
	<link rel="import" href="elements/readme.html">

	<!-- normalize -->
	<link rel="stylesheet" href="css/normalize.min.css">
	<link rel="stylesheet" href="css/app.css">

	<!-- THREE is required for t3 -->
	<script src="bower_components/t3/examples/lib/three.js"></script>
	<script src="bower_components/t3/dist/t3.js"></script>
	<script src="fonts/helvetiker_bold.typeface.js"></script>
	<script src="fonts/helvetiker_regular.typeface.js"></script>
	<!-- graph layout engine -->
	<script src="lib/dagre.min.js"></script>
	<!-- libraries -->
	<script src="lib/d3.js"></script>
	<script src="lib/tween.min.js"></script>
	<script src="bower_components/marked/lib/marked.js"></script>
	<script src="bower_components/highlightjs/highlight.pack.js"></script>

</head>
<body unresolved fullbleed>
	<core-scaffold responsiveWidth="1000px">
		<core-header-panel navigation flex mode="seamed">
			<div class="logo">
				PojoViz
				<div class="subtitle middle">
					Plain Old JavaScript Object Visualization
				</div>
			</div>
			<!-- <div class="" flex> -->
				<!-- Application -->
			<!-- </div> -->
			<core-menu
				id="schemas"
				theme="core-light-theme"
				valueattr="label"
				selected="Known Schemas">

				<core-submenu
					icon="exit-to-app"
					label="Known Schemas"
					>

					<core-item label="Objects"
						data-value="render:object">
					</core-item>

					<core-item label="built-in objects"
						data-value="render:builtIn">
					</core-item>

				</core-submenu>

				<core-submenu
					icon="star"
					label="Notable Libraries"
					>

					<core-item label="jQuery"
						data-src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"
						data-value="render:jQuery"
						data-global="jQuery">
					</core-item>

					<core-item label="Polymer"
						data-value="render:Polymer"
						data-global="Polymer">
					</core-item>

					<core-item label="D3"
						data-global="d3"
						data-allfunctions="true"
						data-value="render:d3">
					</core-item>

					<core-item label="Lo-Dash"
						data-src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.js"
						data-value="render:lodash"
						data-global="_">
					</core-item>

					<core-item label="React"
						data-src="//fb.me/react-0.11.1.js"
						data-value="render:react"
						data-global="React">
					</core-item>

					<core-item label="Angular JS"
						data-src="//cdnjs.cloudflare.com/ajax/libs/angular.js/1.2.20/angular.js"
						data-value="render:angular">
					</core-item>

					<core-item label="Modernizr"
						data-src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.2/modernizr.js"
						data-value="render:modernizr"
						data-global="Modernizr">
					</core-item>

					<core-item label="Handlebars"
						data-src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/1.1.2/handlebars.js"
						data-functionconstructors="false"
						data-value="render:handlebars"
						data-global="Handlebars">
					</core-item>

					<core-item label="EmberJS"
						data-src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js|//cdnjs.cloudflare.com/ajax/libs/handlebars.js/1.1.2/handlebars.js|//cdnjs.cloudflare.com/ajax/libs/ember.js/1.6.1/ember.js"
						data-forbidden='$,Handlebars'
						data-value="render:ember"
						data-global="Ember">
					</core-item>

					<core-item label="Backbone"
						data-src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.js|//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone.js"
						data-value="render:backbone"
						data-global="Backbone">
					</core-item>

					<!-- <core-item label="ExtJS Core"
						data-src="//cdnjs.cloudflare.com/ajax/libs/extjs/4.2.1/builds/ext-core-dev.js"
						data-functionconstructors="false"
						data-value="render:extjs"
						data-global="Ext">
					</core-item> -->

				</core-submenu>

				<core-submenu
					icon="favorite"
					label="My libraries"
					>
					<core-item label="PojoViz"
						data-global="pojoviz"
						data-rendereachtime="true"
						data-value="render:pojoviz">
					</core-item>

					<core-item label="t3"
						data-global="t3"
						data-value="render:t3">
					</core-item>
				</core-submenu>

				<core-submenu
					icon="warning"
					label="Huge Schemas"
					>

					<core-item label="window"
						data-value="render:window">
						<core-tooltip label="huge data is coming" position="right">
							<core-icon icon="warning" size="10"></core-icon>
						</core-tooltip>
					</core-item>

					<!-- declared in object hashes -->
					<core-item label="three.js"
						data-value="render:three">
					</core-item>

					<core-item label="Phaser"
						data-value="render:Phaser"
						data-src="//cdnjs.cloudflare.com/ajax/libs/phaser/2.0.6/phaser.min.js"
						data-global="Phaser">
					</core-item>

				</core-submenu>

			</core-menu>

			<!-- user libraries -->
			<pojoviz-user-menu></pojoviz-user-menu>

		</core-header-panel>

		<!-- title + info -->
		<div tool horizontal layout center style="width: 100%">
			<div class="title"></div>
			<div flex></div>
			<pojoviz-search></pojoviz-search>
			<pojoviz-about></pojoviz-about>
			<core-icon-button
				data-value="settings"
				class="toolbar-page"
				icon="settings">
			</core-icon-button>
			<core-icon-button
				id="readme"
				data-value="readme"
				class="toolbar-page"
				icon="drive-document">
			</core-icon-button>
		</div>

		<core-animated-pages
			transitions="cross-fade"
			valueattr="label">

			<section label="app" class="no-padding">
				<div class="canvas-wrapper" cross-fade>
					<div id="threejscanvas" style="display: none; height: 100%"></div>
					<svg id="canvas" class="unselectable" style="display: none;"></svg>
				</div>
			</section>
			<section label="settings">
				<div class="wrapper" cross-fade>
					<pojoviz-settings></pojoviz-settings>
				</div>
			</section>
			<section label="readme">
				<div class="wrapper" cross-fade>
					<pojoviz-readme></pojoviz-readme>
				</div>
			</section>
		</core-animated-pages>
	</core-scaffold>

	<paper-toast id="toast" text=""></paper-toast>

	<!-- app -->
	<script src="build/pojoviz.js"></script>

	<script>
		// support onpushstate
		(function (history) {
			var pushState = history.pushState;
			history.pushState = function(state) {
				if (typeof history.onpushstate === "function") {
					history.onpushstate({state: state});
				}
				return pushState.apply(history, arguments);
			};
		})(window.history);

		(function () {
			var schemas = document.querySelector('core-header-panel #schemas');
			var pages = document.querySelector('core-animated-pages');
			var scaffold = document.querySelector('core-scaffold');
			var tool = document.querySelector('[tool] .title');
			var currentPage;

			function runLibrary(dataSet) {
				var value,
					action;

				console.log(dataSet);

				value = dataSet.value.split(':');
				action = value[0];
				// global name, data properties
				pojoviz.setContainer(value[1], dataSet)
					.then(function() {
						pojoviz.render();
					})
					.fail(function (e) {
						pojoviz.utils.notification(e);
						throw e;
					})
					.done();
				// pojoviz.render();
				pages.selected = 'app';
				// change title
				tool.textContent = value[1];
				scaffold.closeDrawer();
			}

			function changeHistory(el) {
				window.history.pushState(
					JSON.parse(JSON.stringify(el.dataset)),
					el.dataset.value,
					'#' + el.dataset.value
				);
			}

			schemas.addEventListener('core-select', function (e) {
				var detail = e.detail;
				if (detail.isSelected &&
					!detail.item.$.submenu) {
					changeHistory(detail.item);
				}
			});

			document.addEventListener('library-select', function (e) {
				// runLibrary(e.detail);
				changeHistory(e.detail);
			});

			window.onpopstate = history.onpushstate = function(e) {
				var v = e.state.value;
				if (~v.indexOf('render')) {
					runLibrary(e.state);
					return;
				}

				if (v === 'settings') {
					pages.selected = 'settings';
				} else if (v === 'readme') {
					pages.selected = 'readme';
				}
				tool.textContent = '';
			};

			window.pushState = function (hash) {
				// history
				var el = document.querySelector('[data-value="' +
					hash + '"]');
				if (!el) {
					el = scaffold.querySelector('#readme');
				}
				changeHistory(el);
			};

			// settings + readme
			[].slice.call(scaffold
				.querySelectorAll('core-scaffold .toolbar-page'))
				.forEach(function (v) {
					v.addEventListener('click', function (event) {
						changeHistory(event.target);
					});
				});

			// toast
			var toast = document.getElementById('toast');
			document
				.addEventListener('pojoviz-notification', function (e) {
					toast.text = e.detail;
					toast.show();
				});

			window.addEventListener('polymer-ready', function () {
				var el,
					hash = (history.state && history.state.value) ||
						location.hash.substr(1);

				window.pushState(hash);

				// query params
				var params = {};
				location.search.substring(1).split('&')
					.forEach(function (v) {
						var sp = v.split('=');
						params[sp[0]] = sp[1];
					});

				// hide some elements
				if (params.toolbar === 'false') {
					document.documentElement.className += ' notoolbar';
				}
			});
		})();
	</script>

	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-52923805-1', 'auto');
	  ga('send', 'pageview');
	</script>
</script>
</body>
</html>