<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Pojo Viz</title>

    <script src="bower_components/webcomponentsjs/webcomponents.js"></script>

  <!-- Meta -->
  <meta content="PojoViz" property="og:title">
  <meta content="PojoViz - visualize your code" name="description">
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
	<link rel="icon" href="favicon.ico" type="image/x-icon">

	<link rel="import" href="bower_components/core-scaffold/core-scaffold.html">
	<link rel="import" href="bower_components/core-toolbar/core-toolbar.html">
	<link rel="import" href="bower_components/core-menu/core-menu.html">
	<link rel="import" href="bower_components/core-menu/core-submenu.html">
	<link rel="import" href="bower_components/core-item/core-item.html">
	<link rel="import" href="bower_components/core-animated-pages/core-animated-pages.html">
	<link rel="import" href="bower_components/core-animated-pages/transitions/cross-fade.html">
	<link rel="import" href="bower_components/core-tooltip/core-tooltip.html">
	<link rel="import" href="bower_components/core-icon/core-icon.html">
	<link rel="import" href="bower_components/paper-toast/paper-toast.html">

	<link rel="import" href="elements/settings.html">
	<link rel="import" href="elements/about.html">
	<link rel="import" href="elements/search.html">
	<link rel="import" href="elements/libraryMenu.html">
	<link rel="import" href="elements/readme.html">

	<!-- normalize -->
	<link rel="stylesheet" href="css/normalize.min.css">
	<link rel="stylesheet" href="css/app.css">

	<!-- renderer libraries -->
	<script src="lib/d3.js"></script>
	<script src="lib/tween.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.2/modernizr.min.js"></script>
	<!-- bundle: three + t3 + marked + highlight -->
	<!-- build:js lib/vendor.js -->
	<script type="text/javascript" src="bower_components/t3/examples/lib/three.js"></script>
	<script type="text/javascript" src="bower_components/t3/dist/t3.js"></script>
	<script type="text/javascript" src="bower_components/marked/lib/marked.js"></script>
	<script type="text/javascript" src="bower_components/highlightjs/highlight.pack.js"></script>
	<!-- endbuild -->

</head>
<body unresolved fullbleed>

    <core-scaffold responsiveWidth="1000px">
        <!--sidebar-->
		<core-header-panel navigation flex mode="seamed">
			<div class="logo">
				PojoViz
				<div class="subtitle middle">
					Plain Old JavaScript Object Visualization
				</div>
			</div>

			<!-- libraries shown in the sidebar -->
            <pojoviz-library-menu id="libraries">
            </pojoviz-library-menu>

        </core-header-panel>

		<!-- title + toolbar -->
		<div tool horizontal layout center style="width: 100%">
			<div class="title"></div>
			<div flex></div>

            <!-- GitHub buttons: see http://ghbtns.com -->
            <iframe src="http://ghbtns.com/github-btn.html?user=maurizzzio&amp;repo=PojoViz&amp;type=watch&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="110" height="20"></iframe>

			<pojoviz-search></pojoviz-search>
			<pojoviz-about></pojoviz-about>
			<core-icon-button
				data-type="settings"
				class="toolbar-page"
				icon="settings">
			</core-icon-button>
			<core-icon-button
				id="readme"
				data-type="readme"
				class="toolbar-page"
				icon="description">
			</core-icon-button>
		</div>

        <!--content-->
		<core-animated-pages
			transitions="cross-fade"
			valueattr="label">

			<section label="app" class="no-padding">
				<div class="canvas-wrapper" cross-fade>
                    <!--three js renderer canvas-->
					<div id="threejscanvas" style="display: none; height: 100%"></div>
                    <!--d3 renderer canvas-->
					<svg id="canvas" class="unselectable" style="display: none;"></svg>
				</div>
			</section>
			<section label="settings">
				<div class="wrapper" cross-fade>
					<pojoviz-settings></pojoviz-settings>
				</div>
			</section>
			<section label="readme">
				<div class="wrapper" cross-fade>
					<pojoviz-readme></pojoviz-readme>
				</div>
			</section>
		</core-animated-pages>
	</core-scaffold>
    <!--end app-->

    <!--notification-->
	<paper-toast id="toast" text=""></paper-toast>

	<!-- app -->
	<script src="../build/pojoviz-vendor.js"></script>
	<script src="../build/pojoviz.js"></script>
	<script src="../build/pojoviz-renderers.js"></script>

	<script>
		// support onpushstate
		(function (history) {
			var pushState = history.pushState;
			history.pushState = function(state) {
				if (typeof history.onpushstate === "function") {
					history.onpushstate({state: state});
				}
				return pushState.apply(history, arguments);
			};
		})(window.history);

		(function () {
			var schemas = document.querySelector('core-header-panel #schemas');
			var pages = document.querySelector('core-animated-pages');
			var scaffold = document.querySelector('core-scaffold');
			var tool = document.querySelector('[tool] .title');

			function runLibrary(options) {
				// global name, data properties
				pojoviz
                    .setCurrentInspector(options)
					.then(function() {
						pojoviz.render();
					})
					.fail(function (e) {
						pojoviz.utils.notification(e);
						throw e;
					})
					.done();
				// pojoviz.render();
				pages.selected = 'app';
				// change title
//				tool.textContent = value[1];
				scaffold.closeDrawer();
			}

			function changeHistory(el) {
				window.history.pushState(
					JSON.parse(JSON.stringify(el.dataset)),
					el.dataset.type,
					'#' + el.dataset.type
				);
			}

			window.onpopstate = history.onpushstate = function(e) {
				var type = e.state.type;
				if (~type.indexOf('render')) {
					runLibrary(JSON.parse(e.state.options));
					return;
				}
                pages.selected = type;
				tool.textContent = '';
			};

			window.pushState = function (hash) {
				// on page load find an el with a data-type equal to the hash part
				var el = document.querySelector('html /deep/ [data-type="' +
					hash + '"]');

                // default to readme if it doesn't exist
				if (!el) {
					el = scaffold.querySelector('#readme');
				}
				changeHistory(el);
			};

			// settings + readme on click event
			[].slice.call(scaffold
				.querySelectorAll('core-scaffold .toolbar-page'))
				.forEach(function (v) {
					v.addEventListener('click', function (event) {
						changeHistory(event.target);
					});
				});

			// listen for the event notification to update the status
            // of the toast (polymer's notification)
			var toast = document.getElementById('toast');
			document
				.addEventListener('pojoviz-notification', function (e) {
					toast.text = e.detail;
					toast.show();
				});

			window.addEventListener('polymer-ready', function () {
				// query params
				var params = {};
				location.search.substring(1).split('&')
					.forEach(function (v) {
						var sp = v.split('=');
						params[sp[0]] = sp[1];
					});
                // hide some elements
                if (params.toolbar === 'false') {
                    document.documentElement.className += ' notoolbar';
                }

                // fired from elements/libraryMenu.html
                document.addEventListener('library-select', function (e) {
                    changeHistory(e.detail);
                });

                // bind the configuration of known schemas to the sidebar
                document.getElementById('libraries').sections = [{
                    icon: 'exit-to-app',
                    label: 'Known Schemas',
                    libraries: pojoviz.schemas.knownSchemas
                }, {
                    icon: 'favorite',
                    label: 'Notable Libraries',
                    libraries: pojoviz.schemas.notableLibraries
                }, {
                    icon: 'stars',
                    label: 'My libraries',
                    libraries: pojoviz.schemas.myLibraries
                }, {
                    icon: 'warning',
                    label: 'Huge Schemas',
                    libraries: pojoviz.schemas.hugeSchemas
                }, {
                    icon: 'cloud',
                    label: 'Downloaded',
                    libraries: pojoviz.schemas.downloaded
                }];

                // hash autorender check
                setTimeout(function () {
                    var hash = (history.state && history.state.type) ||
                            location.hash.substr(1);
                    window.pushState(hash);
                }, 0)
            });
		})();
	</script>

	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-52923805-1', 'auto');
	  ga('send', 'pageview');
	</script>
</script>
</body>
</html>